#!/usr/bin/env perl

use lib 'lib';
use v5.10;
use strict;
use warnings;
use Data::Dumper;
use Lifter;

if(-f $ARGV[0]) {
  my $world = Lifter::load_world(shift @ARGV);
  while(1) {
    Lifter::print_map $world;
    say "Water level: $world->{water} Flooding: $world->{flooding_step}/$world->{flooding} Waterproof: $world->{waterproof_step}/$world->{waterproof}" if $world->{flooding};
    say "Score: $world->{score}";
    print "Enter move: ";
    my $move = <>;
    chomp $move;
    $world = Lifter::robot_move($world, $move);
    print_ending($world) if $world->{ending};
    $world = Lifter::check_ending($world);
    print_ending($world) if $world->{ending};
    $world = Lifter::world_update($world);
    print_ending($world) if $world->{ending};
    $world = Lifter::check_ending($world);
    print_ending($world) if $world->{ending};
  }
} else {
  # Contest-mode
  my $map = Lifter::load_map(\*STDIN);
  # ...
}

sub print_ending {
  my $world = shift;
  say "Result: $world->{ending}!";
  say "Partial score: $world->{partial_score}";
  say "Bonus score: $world->{bonus_score}";
  say "Final score: $world->{score}";
  exit;
}

